<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Mistinguette’s source – mistinguette</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-ae44de7e3b26b230a7801128389852ee.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="Mistinguette’s source – mistinguette">
<meta property="og:description" content="A helper for using the Mistral AI API">
<meta property="og:image" content="https://franckalbinet.github.io/mistinguette/00_core_files/figure-html/cell-122-output-1.jpeg">
<meta property="og:site_name" content="mistinguette">
<meta name="twitter:title" content="Mistinguette’s source – mistinguette">
<meta name="twitter:description" content="A helper for using the Mistral AI API">
<meta name="twitter:image" content="https://franckalbinet.github.io/mistinguette/00_core_files/figure-html/cell-122-output-1.jpeg">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">mistinguette</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./core.html">Mistinguette’s source</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">mistinguette</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./core.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Mistinguette’s source</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./toolloop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tool loop</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#setup" id="toc-setup" class="nav-link active" data-scroll-target="#setup">Setup</a>
  <ul class="collapse">
  <li><a href="#can_use_image" id="toc-can_use_image" class="nav-link" data-scroll-target="#can_use_image">can_use_image</a></li>
  <li><a href="#can_set_temperature" id="toc-can_set_temperature" class="nav-link" data-scroll-target="#can_set_temperature">can_set_temperature</a></li>
  <li><a href="#can_set_system_prompt" id="toc-can_set_system_prompt" class="nav-link" data-scroll-target="#can_set_system_prompt">can_set_system_prompt</a></li>
  <li><a href="#can_stream" id="toc-can_stream" class="nav-link" data-scroll-target="#can_stream">can_stream</a></li>
  </ul></li>
  <li><a href="#mistral-sdk" id="toc-mistral-sdk" class="nav-link" data-scroll-target="#mistral-sdk">Mistral SDK</a>
  <ul class="collapse">
  <li><a href="#formatting-output" id="toc-formatting-output" class="nav-link" data-scroll-target="#formatting-output">Formatting output</a></li>
  <li><a href="#find_block" id="toc-find_block" class="nav-link" data-scroll-target="#find_block">find_block</a></li>
  <li><a href="#contents" id="toc-contents" class="nav-link" data-scroll-target="#contents">contents</a></li>
  <li><a href="#usage" id="toc-usage" class="nav-link" data-scroll-target="#usage">usage</a></li>
  <li><a href="#usageinfo.__repr__" id="toc-usageinfo.__repr__" class="nav-link" data-scroll-target="#usageinfo.__repr__">UsageInfo.__repr__</a></li>
  <li><a href="#usageinfo.__add__" id="toc-usageinfo.__add__" class="nav-link" data-scroll-target="#usageinfo.__add__">UsageInfo.__add__</a></li>
  <li><a href="#usageinfo.total" id="toc-usageinfo.total" class="nav-link" data-scroll-target="#usageinfo.total">UsageInfo.total</a></li>
  <li><a href="#creating-messages" id="toc-creating-messages" class="nav-link" data-scroll-target="#creating-messages">Creating messages</a></li>
  </ul></li>
  <li><a href="#client" id="toc-client" class="nav-link" data-scroll-target="#client">Client</a>
  <ul class="collapse">
  <li><a href="#client-1" id="toc-client-1" class="nav-link" data-scroll-target="#client-1">Client</a></li>
  <li><a href="#get_stream" id="toc-get_stream" class="nav-link" data-scroll-target="#get_stream">get_stream</a></li>
  <li><a href="#client.__call__" id="toc-client.__call__" class="nav-link" data-scroll-target="#client.__call__">Client.__call__</a></li>
  </ul></li>
  <li><a href="#tool-use" id="toc-tool-use" class="nav-link" data-scroll-target="#tool-use">Tool use</a>
  <ul class="collapse">
  <li><a href="#mk_mistralai_func" id="toc-mk_mistralai_func" class="nav-link" data-scroll-target="#mk_mistralai_func">mk_mistralai_func</a></li>
  <li><a href="#mk_tool_choice" id="toc-mk_tool_choice" class="nav-link" data-scroll-target="#mk_tool_choice">mk_tool_choice</a></li>
  <li><a href="#call_func_mistralai" id="toc-call_func_mistralai" class="nav-link" data-scroll-target="#call_func_mistralai">call_func_mistralai</a></li>
  <li><a href="#mk_toolres" id="toc-mk_toolres" class="nav-link" data-scroll-target="#mk_toolres">mk_toolres</a></li>
  <li><a href="#mock_tooluse" id="toc-mock_tooluse" class="nav-link" data-scroll-target="#mock_tooluse">mock_tooluse</a></li>
  <li><a href="#client.structured" id="toc-client.structured" class="nav-link" data-scroll-target="#client.structured">Client.structured</a></li>
  </ul></li>
  <li><a href="#chat" id="toc-chat" class="nav-link" data-scroll-target="#chat">Chat</a>
  <ul class="collapse">
  <li><a href="#chat-1" id="toc-chat-1" class="nav-link" data-scroll-target="#chat-1">Chat</a></li>
  <li><a href="#chat.__call__" id="toc-chat.__call__" class="nav-link" data-scroll-target="#chat.__call__">Chat.__call__</a></li>
  <li><a href="#chat-tool-use" id="toc-chat-tool-use" class="nav-link" data-scroll-target="#chat-tool-use">Chat tool use</a></li>
  </ul></li>
  <li><a href="#images" id="toc-images" class="nav-link" data-scroll-target="#images">Images</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/franckalbinet/mistinguette/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="core.html.md"><i class="bi bi-file-code"></i>CommonMark</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Mistinguette’s source</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<hr>
<p><a href="https://github.com/franckalbinet/mistinguette/blob/main/mistinguette/core.py#L89" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="can_use_image" class="level3">
<h3 class="anchored" data-anchor-id="can_use_image">can_use_image</h3>
<blockquote class="blockquote">
<pre><code> can_use_image (m)</code></pre>
</blockquote>
<div id="cell-4" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>model_types <span class="op">=</span> {</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Premier models</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'codestral-2501'</span>: <span class="st">'codestral-latest'</span>, <span class="co"># code generation model</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mistral-large-2411'</span>: <span class="st">'mistral-large-latest'</span>, <span class="co"># top-tier reasoning model for high-complexity tasks</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'pixtral-large-2411'</span>: <span class="st">'pixtral-large-latest'</span>, <span class="co"># frontier-class multimodal model</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mistral-saba-2502'</span>: <span class="st">'mistral-saba-latest'</span>, <span class="co"># model for languages from the Middle East and South Asia</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ministral-3b-2410'</span>: <span class="st">'ministral-3b-latest'</span>, <span class="co"># edge model</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ministral-8b-2410'</span>: <span class="st">'ministral-8b-latest'</span>, <span class="co"># edge model with high performance/price ratio</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mistral-embed-2312'</span>: <span class="st">'mistral-embed'</span>, <span class="co"># embedding model</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mistral-moderation-2411'</span>: <span class="st">'mistral-moderation-latest'</span>, <span class="co"># moderation service to detect harmful text content</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mistral-ocr-2503'</span>: <span class="st">'mistral-ocr-latest'</span>, <span class="co"># OCR model to extract interleaved text and images</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Free models (with weight availability)</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mistral-small-2503'</span>: <span class="st">'mistral-small-latest'</span>, <span class="co"># small model with image understanding capabilities</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Research models</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'open-mistral-nemo-2407'</span>: <span class="st">'open-mistral-nemo'</span>, <span class="co"># multilingual open source model</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-5" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>all_models <span class="op">=</span> <span class="bu">list</span>(model_types)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-6" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>vision_models <span class="op">=</span> [<span class="st">'pixtral-large-2411'</span>, <span class="st">'mistral-small-2503'</span>, <span class="st">'mistral-ocr-2503'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-7" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>embed_models <span class="op">=</span> [<span class="st">'mistral-embed-2312'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-8" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>ocr_models <span class="op">=</span> [<span class="st">'mistral-ocr-2503'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-9" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>tool_models <span class="op">=</span> [<span class="st">'codestral-2501'</span>, <span class="st">'mistral-large-2411'</span>, </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">'mistral-small-2503'</span>, <span class="st">'ministral-3b-2410'</span>, <span class="st">'ministral-8b-2410'</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">'pixtral-large-2411'</span>, <span class="st">'open-mistral-nemo-2407'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-10" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>text_only_models <span class="op">=</span> <span class="bu">set</span>(all_models) <span class="op">-</span> <span class="bu">set</span>(vision_models) <span class="op">-</span> <span class="bu">set</span>(embed_models) <span class="op">-</span> <span class="bu">set</span>(ocr_models)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-11" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>has_streaming_models <span class="op">=</span> <span class="bu">set</span>(all_models) <span class="op">-</span> <span class="bu">set</span>(embed_models) <span class="op">-</span> <span class="bu">set</span>(ocr_models)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>has_system_prompt_models <span class="op">=</span> <span class="bu">set</span>(all_models) <span class="op">-</span> <span class="bu">set</span>(embed_models) <span class="op">-</span> <span class="bu">set</span>(ocr_models)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>has_temperature_models <span class="op">=</span> <span class="bu">set</span>(all_models) <span class="op">-</span> <span class="bu">set</span>(embed_models) <span class="op">-</span> <span class="bu">set</span>(ocr_models)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-12" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> can_stream(m): <span class="cf">return</span> m <span class="kw">in</span> has_streaming_models</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> can_set_system_prompt(m): <span class="cf">return</span> m <span class="kw">in</span> has_system_prompt_models</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> can_set_temperature(m): <span class="cf">return</span> m <span class="kw">in</span> has_temperature_models</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> can_use_image(m): <span class="cf">return</span> m <span class="kw">in</span> vision_models</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p><a href="https://github.com/franckalbinet/mistinguette/blob/main/mistinguette/core.py#L88" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="can_set_temperature" class="level3">
<h3 class="anchored" data-anchor-id="can_set_temperature">can_set_temperature</h3>
<blockquote class="blockquote">
<pre><code> can_set_temperature (m)</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/franckalbinet/mistinguette/blob/main/mistinguette/core.py#L87" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="can_set_system_prompt" class="level3">
<h3 class="anchored" data-anchor-id="can_set_system_prompt">can_set_system_prompt</h3>
<blockquote class="blockquote">
<pre><code> can_set_system_prompt (m)</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/franckalbinet/mistinguette/blob/main/mistinguette/core.py#L86" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="can_stream" class="level3">
<h3 class="anchored" data-anchor-id="can_stream">can_stream</h3>
<blockquote class="blockquote">
<pre><code> can_stream (m)</code></pre>
</blockquote>
<div id="cell-16" class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># all models except codestral-mamba support custom structured outputs</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-17" class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> models[<span class="dv">1</span>]<span class="op">;</span> model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>'mistral-large-2411'</code></pre>
</div>
</div>
</section>
</section>
<section id="mistral-sdk" class="level2">
<h2 class="anchored" data-anchor-id="mistral-sdk">Mistral SDK</h2>
<div id="cell-19" class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>cli <span class="op">=</span> Mistral(api_key<span class="op">=</span>MISTRAL_API_KEY)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is what Mistral’s SDK provides for interacting with Python. To use it, pass it a list of <em>messages</em>, with <em>content</em> and a <em>role</em>. The roles should alternate between <em>user</em> and <em>assistant</em>.</p>
<div id="cell-21" class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>messages <span class="op">=</span> [</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"role"</span>: <span class="st">"user"</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"content"</span>: [</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>            {</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">"type"</span>: <span class="st">"text"</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>                <span class="st">"text"</span>: <span class="st">"What's in this image?"</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>            {</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>                <span class="st">"type"</span>: <span class="st">"image_url"</span>,</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>                <span class="st">"image_url"</span>: <span class="st">"https://tripfixers.com/wp-content/uploads/2019/11/eiffel-tower-with-snow.jpeg"</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the chat response</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>chat_response <span class="op">=</span> cli.chat.complete(</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span><span class="st">'pixtral-large-2411'</span>,</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    messages<span class="op">=</span>messages</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-22" class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>chat_response</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>ChatCompletionResponse(id='7b394afb791f4b00afba2da0f7e23814', object='chat.completion', model='pixtral-large-2411', usage=UsageInfo(prompt_tokens=1360, completion_tokens=133, total_tokens=1493), created=1743585871, choices=[ChatCompletionChoice(index=0, message=AssistantMessage(content="The image depicts the Eiffel Tower in Paris, France, on a snowy winter day. The iconic tower is prominently featured in the background, covered with a light layer of snow, giving it a picturesque and serene appearance. The surrounding area includes leafless trees, their branches also dusted with snow, enhancing the wintery ambiance. The ground is blanketed in white, and the scene is framed by a classic Parisian lamp post and a fenced pathway. The overall setting exudes a calm, peaceful, and almost magical winter atmosphere in one of the world's most famous landmarks.", tool_calls=None, prefix=False, role='assistant'), finish_reason='stop')])</code></pre>
</div>
</div>
<div id="cell-23" class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>messages <span class="op">=</span> [</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"role"</span>: <span class="st">"user"</span>,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"content"</span>: [</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>            {</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">"type"</span>: <span class="st">"text"</span>,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>                <span class="st">"text"</span>: <span class="st">"What's in this image?"</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>            {</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>                <span class="st">"type"</span>: <span class="st">"image_url"</span>,</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>                <span class="st">"image_url"</span>: <span class="st">"https://tripfixers.com/wp-content/uploads/2019/11/eiffel-tower-with-snow.jpeg"</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the chat response</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>stream_response <span class="op">=</span> cli.chat.stream(</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span><span class="st">'pixtral-large-2411'</span>,</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>    messages<span class="op">=</span>messages</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-24" class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> chunk <span class="kw">in</span> stream_response:</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(chunk.data.choices[<span class="dv">0</span>].delta.content)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
The
 image
 features
 a
 snow
y
 scene
 of
 the
 E
iff
el
 Tower
 in
 Paris
,
 France
.
 The
 icon
ic
 structure
 is
 seen
 in
 the
 background
,
 tow
ering
 above
 the
 snow
-
covered
 landscape
.
 The
 fore
ground
 displays
 a
 pictures
que
 path
way
 lined
 with
 bare
 trees
,
 their
 branches
 lightly
 dust
ed
 with
 snow
.
 A
 classic
 Paris
ian
 l
am
pp
ost
 is
 visible
 along
 the
 path
way
,
 adding
 to
 the
 winter
 charm
.
 The
 overall
 atmosphere
 is
 ser
ene
 and
 magical
,
 show
c
asing
 the
 beauty
 of
 Paris
 during
 the
 winter
 season
.
</code></pre>
</div>
</div>
<div id="cell-25" class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Here are the list of different client methods:</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># - chat.complete (completion)</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co"># - chat.stream (completion streaming)</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># - chat.parse (structured output for instance)</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># - chat.fim.complete (fim: fill in middle / code generation)</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co"># - chat.ocr.process (ocr)</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co"># - chat.embeddings.create (embedding creation)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-26" class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> {<span class="st">'role'</span>: <span class="st">'user'</span>, <span class="st">'content'</span>: <span class="st">"I'm Jeremy"</span>}</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> cli.chat.complete(messages <span class="op">=</span> [m], model <span class="op">=</span> model)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>r</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>ChatCompletionResponse(id='b6ed028d89724a50a70df00904a1bf93', object='chat.completion', model='mistral-large-2411', usage=UsageInfo(prompt_tokens=7, completion_tokens=27, total_tokens=34), created=1743585882, choices=[ChatCompletionChoice(index=0, message=AssistantMessage(content='Hello Jeremy! Nice to meet you. How are you doing today? Is there something you would like to talk about or do?', tool_calls=None, prefix=False, role='assistant'), finish_reason='stop')])</code></pre>
</div>
</div>
<div id="cell-27" class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(r)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>id='b6ed028d89724a50a70df00904a1bf93' object='chat.completion' model='mistral-large-2411' usage=UsageInfo(prompt_tokens=7, completion_tokens=27, total_tokens=34) created=1743585882 choices=[ChatCompletionChoice(index=0, message=AssistantMessage(content='Hello Jeremy! Nice to meet you. How are you doing today? Is there something you would like to talk about or do?', tool_calls=None, prefix=False, role='assistant'), finish_reason='stop')]</code></pre>
</div>
</div>
<section id="formatting-output" class="level3">
<h3 class="anchored" data-anchor-id="formatting-output">Formatting output</h3>
<div id="cell-29" class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Notes:</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co">#  - assistant message with prefix true, should be last message</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  - assistant message with prefix false cannot be last.</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Type of messages:</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co">#  - system: instructions for the assistant (system prompt I guess - sp)  (content, role='system')</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co">#  - user: user message (content, role='user')  </span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co">#  - assistant: assistant message (content, tool_calls, prefix, role='assistant')</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co">#  - tool: tool call (content, tool_call_id, name, role='tool')</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Check also:</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="co"># - prefix</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="co"># - safe_prompt (for guardrailing)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><a href="https://github.com/franckalbinet/mistinguette/blob/main/mistinguette/core.py#L95" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="find_block" class="level3">
<h3 class="anchored" data-anchor-id="find_block">find_block</h3>
<blockquote class="blockquote">
<pre><code> find_block (r:collections.abc.Mapping)</code></pre>
</blockquote>
<p><em>Find the message in <code>r</code></em></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>r</td>
<td>Mapping</td>
<td>The message to look in</td>
</tr>
</tbody>
</table>
<div id="cell-31" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_block(r:abc.Mapping, <span class="co"># The message to look in</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>              ):</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Find the message in `r`"</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(r, CompletionEvent): r <span class="op">=</span> r.data <span class="co"># if async</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    m <span class="op">=</span> nested_idx(r, <span class="st">'choices'</span>, <span class="dv">0</span>)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> m: <span class="cf">return</span> m</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">hasattr</span>(m, <span class="st">'message'</span>): <span class="cf">return</span> m.message</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> m.delta</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-32" class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>find_block(r)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>AssistantMessage(content='Hello Jeremy! Nice to meet you. How are you doing today? Is there something you would like to talk about or do?', tool_calls=None, prefix=False, role='assistant')</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/franckalbinet/mistinguette/blob/main/mistinguette/core.py#L105" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="contents" class="level3">
<h3 class="anchored" data-anchor-id="contents">contents</h3>
<blockquote class="blockquote">
<pre><code> contents (r)</code></pre>
</blockquote>
<p><em>Helper to get the contents from response <code>r</code>.</em></p>
<div id="cell-34" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> contents(r):</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Helper to get the contents from response `r`."</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    blk <span class="op">=</span> find_block(r)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> blk: <span class="cf">return</span> r</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">hasattr</span>(blk, <span class="st">'content'</span>): <span class="cf">return</span> <span class="bu">getattr</span>(blk,<span class="st">'content'</span>)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> blk</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-35" class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>contents(r)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>'Hello Jeremy! Nice to meet you. How are you doing today? Is there something you would like to talk about or do?'</code></pre>
</div>
</div>
<div id="cell-36" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="at">@patch</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _repr_markdown_(<span class="va">self</span>:ChatCompletionResponse):</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    det <span class="op">=</span> <span class="st">'</span><span class="ch">\n</span><span class="st">- '</span>.join(<span class="ss">f'</span><span class="sc">{</span>k<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>v<span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> k,v <span class="kw">in</span> <span class="bu">dict</span>(<span class="va">self</span>).items())</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> contents(<span class="va">self</span>)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> res: <span class="cf">return</span> <span class="ss">f"- </span><span class="sc">{</span>det<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="ss">f"""</span><span class="sc">{</span>contents(<span class="va">self</span>)<span class="sc">}</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;details&gt;</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="sc">{</span>det<span class="sc">}</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/details&gt;"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-37" class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>r</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown">
<p>Hello Jeremy! Nice to meet you. How are you doing today? Is there something you would like to talk about or do?</p>
<details>
<ul>
<li>id: b6ed028d89724a50a70df00904a1bf93</li>
<li>object: chat.completion</li>
<li>model: mistral-large-2411</li>
<li>usage: prompt_tokens=7 completion_tokens=27 total_tokens=34</li>
<li>created: 1743585882</li>
<li>choices: [ChatCompletionChoice(index=0, message=AssistantMessage(content=‘Hello Jeremy! Nice to meet you. How are you doing today? Is there something you would like to talk about or do?’, tool_calls=None, prefix=False, role=‘assistant’), finish_reason=‘stop’)]</li>
</ul>
</details>
</div>
</div>
<div id="cell-38" class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>r.usage</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>UsageInfo(prompt_tokens=7, completion_tokens=27, total_tokens=34)</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/franckalbinet/mistinguette/blob/main/mistinguette/core.py#L127" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="usage" class="level3">
<h3 class="anchored" data-anchor-id="usage">usage</h3>
<blockquote class="blockquote">
<pre><code> usage (inp=0, out=0)</code></pre>
</blockquote>
<p><em>Slightly more concise version of <code>UsageInfo</code>.</em></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>inp</td>
<td>int</td>
<td>0</td>
<td>input tokens</td>
</tr>
<tr class="even">
<td>out</td>
<td>int</td>
<td>0</td>
<td>Output tokens</td>
</tr>
</tbody>
</table>
<div id="cell-40" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> usage(inp<span class="op">=</span><span class="dv">0</span>, <span class="co"># input tokens</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>          out<span class="op">=</span><span class="dv">0</span>,  <span class="co"># Output tokens</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>         ):</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Slightly more concise version of `UsageInfo`."</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> UsageInfo(prompt_tokens<span class="op">=</span>inp, completion_tokens<span class="op">=</span>out, total_tokens<span class="op">=</span>inp<span class="op">+</span>out)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-41" class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>usage(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>UsageInfo(prompt_tokens=5, completion_tokens=0, total_tokens=5)</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/franckalbinet/mistinguette/blob/main/mistinguette/core.py#L135" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="usageinfo.__repr__" class="level3">
<h3 class="anchored" data-anchor-id="usageinfo.__repr__">UsageInfo.__repr__</h3>
<blockquote class="blockquote">
<pre><code> UsageInfo.__repr__ ()</code></pre>
</blockquote>
<p><em>Return repr(self).</em></p>
<div id="cell-43" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="at">@patch</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="fu">__repr__</span>(<span class="va">self</span>:UsageInfo): <span class="cf">return</span> <span class="ss">f'In: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>prompt_tokens<span class="sc">}</span><span class="ss">; Out: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>completion_tokens<span class="sc">}</span><span class="ss">; Total: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>total_tokens<span class="sc">}</span><span class="ss">'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-44" class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>r.usage</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>In: 7; Out: 27; Total: 34</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/franckalbinet/mistinguette/blob/main/mistinguette/core.py#L139" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="usageinfo.__add__" class="level3">
<h3 class="anchored" data-anchor-id="usageinfo.__add__">UsageInfo.__add__</h3>
<blockquote class="blockquote">
<pre><code> UsageInfo.__add__ (b)</code></pre>
</blockquote>
<p><em>Add together each of <code>input_tokens</code> and <code>output_tokens</code></em></p>
<div id="cell-46" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="at">@patch</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="fu">__add__</span>(<span class="va">self</span>:UsageInfo, b):</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Add together each of `input_tokens` and `output_tokens`"</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> usage(<span class="va">self</span>.prompt_tokens<span class="op">+</span>b.prompt_tokens, <span class="va">self</span>.completion_tokens<span class="op">+</span>b.completion_tokens)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-47" class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>r.usage<span class="op">+</span>r.usage</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>In: 14; Out: 54; Total: 68</code></pre>
</div>
</div>
<div id="cell-48" class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Is it relevant to Mistral AI: </span><span class="al">TBD</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> wrap_latex(text, md<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Replace MistralAI LaTeX codes with markdown-compatible ones"</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> re.sub(<span class="vs">r"\\\((.*?)\\\)"</span>, <span class="kw">lambda</span> o: <span class="ss">f"$</span><span class="sc">{</span>o<span class="sc">.</span>group(<span class="dv">1</span>)<span class="sc">}</span><span class="ss">$"</span>, text)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> re.sub(<span class="vs">r"\\\[(.*?)\\\]"</span>, <span class="kw">lambda</span> o: <span class="ss">f"$$</span><span class="sc">{</span>o<span class="sc">.</span>group(<span class="dv">1</span>)<span class="sc">}</span><span class="ss">$$"</span>, text, flags<span class="op">=</span>re.DOTALL)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> md: res <span class="op">=</span> display.Markdown(res)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><a href="https://github.com/franckalbinet/mistinguette/blob/main/mistinguette/core.py#L145" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="usageinfo.total" class="level3">
<h3 class="anchored" data-anchor-id="usageinfo.total">UsageInfo.total</h3>
<blockquote class="blockquote">
<pre><code> UsageInfo.total ()</code></pre>
</blockquote>
<div id="cell-50" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="at">@patch</span>(as_prop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> total(<span class="va">self</span>:UsageInfo): <span class="cf">return</span> <span class="va">self</span>.total_tokens</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-51" class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>usage(<span class="dv">5</span>,<span class="dv">1</span>).total</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>6</code></pre>
</div>
</div>
</section>
<section id="creating-messages" class="level3">
<h3 class="anchored" data-anchor-id="creating-messages">Creating messages</h3>
<p>Creating message dictionaries manually can be tedious, so we’ll use helper functions from the <code>msglm</code> library.</p>
<p>We’ll use <code>mk_msg</code> to easily create messages like <code>{'role': 'user', 'content': "I'm Jeremy"}</code>. Since Mistral AI’s message format is compatible with OpenAI’s structure, we imported : <code>from msglm import mk_msg_openai as mk_msg, mk_msgs_openai as mk_msgs</code></p>
<div id="cell-54" class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>prompt <span class="op">=</span> <span class="st">"I'm Jeremy"</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> mk_msg(prompt)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> cli.chat.complete(messages<span class="op">=</span>[m], model<span class="op">=</span>model, max_tokens<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>r</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown">
<p>Hello Jeremy! Nice to meet you. How can I assist you today? Let’s have a friendly conversation. 😊 How are you doing?</p>
<details>
<ul>
<li>id: defc0db8f5f94fb3a47f2fffeffacc3e</li>
<li>object: chat.completion</li>
<li>model: mistral-large-2411</li>
<li>usage: prompt_tokens=7 completion_tokens=31 total_tokens=38</li>
<li>created: 1743585891</li>
<li>choices: [ChatCompletionChoice(index=0, message=AssistantMessage(content=“Hello Jeremy! Nice to meet you. How can I assist you today? Let’s have a friendly conversation. 😊 How are you doing?”, tool_calls=None, prefix=False, role=‘assistant’), finish_reason=‘stop’)]</li>
</ul>
</details>
</div>
</div>
<p>We can pass more than just text messages to Mistral AI. As we’ll see later we can also pass images, SDK objects, etc. To handle these different data types we need to pass the type along with our content to OpenAI.</p>
<p>Here’s an example of a multimodal message containing text and images.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>    <span class="er">'role'</span><span class="fu">:</span> <span class="er">'user'</span><span class="fu">,</span> </span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>    <span class="er">'content'</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span><span class="er">'type'</span><span class="fu">:</span> <span class="er">'text'</span><span class="fu">,</span> <span class="er">'text'</span><span class="fu">:</span> <span class="er">'What</span> <span class="er">is</span> <span class="er">in</span> <span class="er">the</span> <span class="er">image?'</span><span class="fu">}</span><span class="ot">,</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span><span class="er">'type'</span><span class="fu">:</span> <span class="er">'image_url'</span><span class="fu">,</span> <span class="er">'image_url'</span><span class="fu">:</span> <span class="fu">{</span><span class="er">'url'</span><span class="fu">:</span> <span class="er">f'data:</span><span class="fu">{</span><span class="er">MEDIA_TYPE</span><span class="fu">}</span><span class="er">;base64</span><span class="fu">,</span><span class="er">{IMG</span><span class="fu">}</span><span class="er">'</span><span class="fu">}</span><span class="er">}</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>mk_msg</code> infers the type automatically and creates the appropriate data structure.</p>
<p>LLMs, don’t actually have state, but instead dialogs are created by passing back all previous prompts and responses every time. With Mistral AI, they always alternate <em>user</em> and <em>assistant</em>. We’ll use <code>mk_msgs</code> from <code>msglm</code> to make it easier to build up these dialog lists.</p>
<div id="cell-57" class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>msgs <span class="op">=</span> mk_msgs([prompt, r, <span class="st">"I forgot my name. Can you remind me please?"</span>]) </span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>msgs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[{'role': 'user', 'content': "I'm Jeremy"},
 AssistantMessage(content="Hello Jeremy! Nice to meet you. How can I assist you today? Let's have a friendly conversation. 😊 How are you doing?", tool_calls=None, prefix=False, role='assistant'),
 {'role': 'user', 'content': 'I forgot my name. Can you remind me please?'}]</code></pre>
</div>
</div>
<div id="cell-58" class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> cli.chat.complete(messages<span class="op">=</span>msgs, model<span class="op">=</span>model, max_tokens<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>r</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown">
<p>Of course! You just told me your name is Jeremy.</p>
<details>
<ul>
<li>id: 329522f02b7c499597ad0f72664ba439</li>
<li>object: chat.completion</li>
<li>model: mistral-large-2411</li>
<li>usage: prompt_tokens=51 completion_tokens=13 total_tokens=64</li>
<li>created: 1743585893</li>
<li>choices: [ChatCompletionChoice(index=0, message=AssistantMessage(content=‘Of course! You just told me your name is Jeremy.’, tool_calls=None, prefix=False, role=‘assistant’), finish_reason=‘stop’)]</li>
</ul>
</details>
</div>
</div>
<p>In addition to the standard ‘user’ and ‘assistant’ roles found in the OpenAI API for instance, Mistral AI’s API also supports ‘system’ roles for providing instructions to the model and ‘tool’ roles for tool-based interactions.</p>
<p>Let’s see it in action as demonstrated in <a href="https://docs.mistral.ai/guides/prefix/">Mistral AI’s guide</a> on prefix use cases.</p>
<div id="cell-60" class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>instruction <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="st">Let's roleplay.</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="st">Always give a single reply.</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="st">Roleplay only, using dialogue only.</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="st">Do not send any comments.</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="st">Do not send any notes.</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a><span class="st">Do not send any disclaimers.</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>question <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a><span class="st">Hi there!</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>prefix <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a><span class="st">Shakespeare: </span></span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> cli.chat.complete(</span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span><span class="st">"mistral-small-latest"</span>,</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>    messages<span class="op">=</span>[</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>        mk_msg(instruction, role<span class="op">=</span><span class="st">"system"</span>),</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>        mk_msg(question, role<span class="op">=</span><span class="st">"user"</span>),</span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>        mk_msg(prefix, role<span class="op">=</span><span class="st">"assistant"</span>, prefix<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>    max_tokens<span class="op">=</span><span class="dv">128</span>,</span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>r</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown">
<p>Shakespeare: Good morrow! Who art thou that greetest me so?</p>
<details>
<ul>
<li>id: ee991b548b83482ea1544aeaf5d60308</li>
<li>object: chat.completion</li>
<li>model: mistral-small-latest</li>
<li>usage: prompt_tokens=55 completion_tokens=19 total_tokens=74</li>
<li>created: 1743585900</li>
<li>choices: [ChatCompletionChoice(index=0, message=AssistantMessage(content=‘: morrow! Who art thou that greetest me so?’, tool_calls=None, prefix=False, role=‘assistant’), finish_reason=‘stop’)]</li>
</ul>
</details>
</div>
</div>
</section>
</section>
<section id="client" class="level2">
<h2 class="anchored" data-anchor-id="client">Client</h2>
<div id="cell-62" class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Note also the .fim (fill in middle) mistral method</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><a href="https://github.com/franckalbinet/mistinguette/blob/main/mistinguette/core.py#L148" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="client-1" class="level3">
<h3 class="anchored" data-anchor-id="client-1">Client</h3>
<blockquote class="blockquote">
<pre><code> Client (model, cli=None)</code></pre>
</blockquote>
<p><em>Basic LLM messages client.</em></p>
<div id="cell-64" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Client:</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, model, cli<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>        <span class="co">"Basic LLM messages client."</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.model,<span class="va">self</span>.use <span class="op">=</span> model,usage(<span class="dv">0</span>,<span class="dv">0</span>)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.text_only <span class="op">=</span> model <span class="kw">in</span> text_only_models</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.can_use_tools <span class="op">=</span> model <span class="kw">in</span> tool_models</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.c <span class="op">=</span> (cli <span class="kw">or</span> Mistral(api_key<span class="op">=</span>os.environ.get(<span class="st">"MISTRAL_API_KEY"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-65" class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> Client(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-66" class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>c.use</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>In: 0; Out: 0; Total: 0</code></pre>
</div>
</div>
<div id="cell-67" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="at">@patch</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _r(<span class="va">self</span>:Client, r:ChatCompletionResponse):</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Store the result of the message and accrue total usage."</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.result <span class="op">=</span> r</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">getattr</span>(r,<span class="st">'usage'</span>,<span class="va">None</span>): <span class="va">self</span>.use <span class="op">+=</span> r.usage</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> r</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-68" class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>c._r(r)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>c.use</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>In: 55; Out: 19; Total: 74</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/franckalbinet/mistinguette/blob/main/mistinguette/core.py#L165" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="get_stream" class="level3">
<h3 class="anchored" data-anchor-id="get_stream">get_stream</h3>
<blockquote class="blockquote">
<pre><code> get_stream (r)</code></pre>
</blockquote>
<p>Note that <code>mistralai.Chat.complete</code> and <code>mistralai.Chat.stream</code> have the same signature, we <strong>delegate</strong> to <code>mistralai.Chat.complete</code> below to avoid obfuscating <code>**kwargs</code> parameters as explained in <a href="https://fastcore.fast.ai/meta.html#delegates">fastcore documentation</a>.</p>
<hr>
<p><a href="https://github.com/franckalbinet/mistinguette/blob/main/mistinguette/core.py#L173" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="client.__call__" class="level3">
<h3 class="anchored" data-anchor-id="client.__call__">Client.__call__</h3>
<blockquote class="blockquote">
<pre><code> Client.__call__ (msgs:list, sp:str='', maxtok=4096, stream:bool=False,
                  temperature:OptionalNullable[float]=Unset(),
                  top_p:Optional[float]=None,
                  max_tokens:OptionalNullable[int]=Unset(),
                  stop:Union[Stop,StopTypedDict,NoneType]=None,
                  random_seed:OptionalNullable[int]=Unset(), response_form
                  at:Union[mistralai.models.responseformat.ResponseFormat,
                  mistralai.models.responseformat.ResponseFormatTypedDict,
                  NoneType]=None, tools:OptionalNullable[typing.Union[typi
                  ng.List[mistralai.models.tool.Tool],typing.List[mistrala
                  i.models.tool.ToolTypedDict]]]=Unset(), tool_choice:Unio
                  n[ChatCompletionRequestToolChoice,ChatCompletionRequestT
                  oolChoiceTypedDict,NoneType]=None,
                  presence_penalty:Optional[float]=None,
                  frequency_penalty:Optional[float]=None,
                  n:OptionalNullable[int]=Unset(), prediction:Union[mistra
                  lai.models.prediction.Prediction,mistralai.models.predic
                  tion.PredictionTypedDict,NoneType]=None,
                  parallel_tool_calls:Optional[bool]=None,
                  safe_prompt:Optional[bool]=None, retries:OptionalNullabl
                  e[mistralai.utils.retries.RetryConfig]=Unset(),
                  server_url:Optional[str]=None,
                  timeout_ms:Optional[int]=None,
                  http_headers:Optional[Mapping[str,str]]=None)</code></pre>
</blockquote>
<p><em>Make a call to LLM.</em></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>msgs</td>
<td>list</td>
<td></td>
<td>List of messages in the dialog</td>
</tr>
<tr class="even">
<td>sp</td>
<td>str</td>
<td></td>
<td>System prompt</td>
</tr>
<tr class="odd">
<td>maxtok</td>
<td>int</td>
<td>4096</td>
<td>Maximum tokens</td>
</tr>
<tr class="even">
<td>stream</td>
<td>bool</td>
<td>False</td>
<td>Stream response?</td>
</tr>
<tr class="odd">
<td>temperature</td>
<td>OptionalNullable</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>top_p</td>
<td>Optional</td>
<td>None</td>
<td></td>
</tr>
<tr class="odd">
<td>max_tokens</td>
<td>OptionalNullable</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>stop</td>
<td>Union</td>
<td>None</td>
<td></td>
</tr>
<tr class="odd">
<td>random_seed</td>
<td>OptionalNullable</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>response_format</td>
<td>Union</td>
<td>None</td>
<td></td>
</tr>
<tr class="odd">
<td>tools</td>
<td>OptionalNullable</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>tool_choice</td>
<td>Union</td>
<td>None</td>
<td></td>
</tr>
<tr class="odd">
<td>presence_penalty</td>
<td>Optional</td>
<td>None</td>
<td></td>
</tr>
<tr class="even">
<td>frequency_penalty</td>
<td>Optional</td>
<td>None</td>
<td></td>
</tr>
<tr class="odd">
<td>n</td>
<td>OptionalNullable</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>prediction</td>
<td>Union</td>
<td>None</td>
<td></td>
</tr>
<tr class="odd">
<td>parallel_tool_calls</td>
<td>Optional</td>
<td>None</td>
<td></td>
</tr>
<tr class="even">
<td>safe_prompt</td>
<td>Optional</td>
<td>None</td>
<td></td>
</tr>
<tr class="odd">
<td>retries</td>
<td>OptionalNullable</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>server_url</td>
<td>Optional</td>
<td>None</td>
<td></td>
</tr>
<tr class="odd">
<td>timeout_ms</td>
<td>Optional</td>
<td>None</td>
<td></td>
</tr>
<tr class="even">
<td>http_headers</td>
<td>Optional</td>
<td>None</td>
<td></td>
</tr>
</tbody>
</table>
<div id="cell-72" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="at">@patch</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="at">@delegates</span>(mistralai.Chat.complete)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="fu">__call__</span>(<span class="va">self</span>:Client,</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>             msgs:<span class="bu">list</span>, <span class="co"># List of messages in the dialog</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>             sp:<span class="bu">str</span><span class="op">=</span><span class="st">''</span>, <span class="co"># System prompt</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>             maxtok<span class="op">=</span><span class="dv">4096</span>, <span class="co"># Maximum tokens</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>             stream:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span>, <span class="co"># Stream response?</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>             <span class="op">**</span>kwargs):</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Make a call to LLM."</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'tools'</span> <span class="kw">in</span> kwargs: <span class="cf">assert</span> <span class="va">self</span>.can_use_tools, <span class="st">"Tool use is not supported by the current model type."</span></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">any</span>(c[<span class="st">'type'</span>] <span class="op">==</span> <span class="st">'image_url'</span> <span class="cf">for</span> msg <span class="kw">in</span> msgs <span class="cf">if</span> <span class="bu">isinstance</span>(msg, <span class="bu">dict</span>) <span class="kw">and</span> <span class="bu">isinstance</span>(msg.get(<span class="st">'content'</span>), <span class="bu">list</span>) <span class="cf">for</span> c <span class="kw">in</span> msg[<span class="st">'content'</span>]): <span class="cf">assert</span> <span class="kw">not</span> <span class="va">self</span>.text_only, <span class="st">"Images are not supported by the current model type."</span></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> sp <span class="kw">and</span> <span class="va">self</span>.model <span class="kw">in</span> has_system_prompt_models: msgs <span class="op">=</span> [mk_msg(sp, <span class="st">'system'</span>)] <span class="op">+</span> <span class="bu">list</span>(msgs)</span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>    chat_args <span class="op">=</span> <span class="bu">dict</span>(model<span class="op">=</span><span class="va">self</span>.model, messages<span class="op">=</span>msgs, max_tokens<span class="op">=</span>maxtok, <span class="op">**</span>kwargs)</span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> <span class="va">self</span>.c.chat.stream(<span class="op">**</span>chat_args) <span class="cf">if</span> stream <span class="cf">else</span> <span class="va">self</span>.c.chat.complete(<span class="op">**</span>chat_args)</span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">self</span>._r(r) <span class="cf">if</span> <span class="kw">not</span> stream <span class="cf">else</span> get_stream(<span class="bu">map</span>(<span class="va">self</span>._r, r))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-73" class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>msgs <span class="op">=</span> [mk_msg(<span class="st">'Hi'</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-74" class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>c(msgs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown">
<p>Hello! How can I assist you today? Let’s have a friendly conversation. 😊 How are you doing?</p>
<details>
<ul>
<li>id: c7803d4dbdf148b79b22933cc0ca36bf</li>
<li>object: chat.completion</li>
<li>model: mistral-large-2411</li>
<li>usage: prompt_tokens=4 completion_tokens=25 total_tokens=29</li>
<li>created: 1743585912</li>
<li>choices: [ChatCompletionChoice(index=0, message=AssistantMessage(content=“Hello! How can I assist you today? Let’s have a friendly conversation. 😊 How are you doing?”, tool_calls=None, prefix=False, role=‘assistant’), finish_reason=‘stop’)]</li>
</ul>
</details>
</div>
</div>
<div id="cell-75" class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>c.use</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>In: 59; Out: 44; Total: 103</code></pre>
</div>
</div>
<div id="cell-76" class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> o <span class="kw">in</span> c(msgs, stream<span class="op">=</span><span class="va">True</span>): <span class="bu">print</span>(o, end<span class="op">=</span><span class="st">''</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Hello! How can I assist you today? If you're up for it, I'd love to share a fun fact or a interesting topic to kick things off. How does that sound?</code></pre>
</div>
</div>
<div id="cell-77" class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>c.use</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>In: 59; Out: 44; Total: 103</code></pre>
</div>
</div>
</section>
</section>
<section id="tool-use" class="level2">
<h2 class="anchored" data-anchor-id="tool-use">Tool use</h2>
<div id="cell-79" class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sums(</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>    a:<span class="bu">int</span>,  <span class="co"># First thing to sum</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>    b:<span class="bu">int</span> <span class="co"># Second thing to sum</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> <span class="bu">int</span>: <span class="co"># The sum of the inputs</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Adds a + b."</span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Finding the sum of </span><span class="sc">{</span>a<span class="sc">}</span><span class="ss"> and </span><span class="sc">{</span>b<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">+</span> b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><a href="https://github.com/franckalbinet/mistinguette/blob/main/mistinguette/core.py#L188" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="mk_mistralai_func" class="level3">
<h3 class="anchored" data-anchor-id="mk_mistralai_func">mk_mistralai_func</h3>
<blockquote class="blockquote">
<pre><code> mk_mistralai_func (f)</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/franckalbinet/mistinguette/blob/main/mistinguette/core.py#L194" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="mk_tool_choice" class="level3">
<h3 class="anchored" data-anchor-id="mk_tool_choice">mk_tool_choice</h3>
<blockquote class="blockquote">
<pre><code> mk_tool_choice (f)</code></pre>
</blockquote>
<div id="cell-82" class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>sysp <span class="op">=</span> <span class="st">"You are a helpful assistant. When using tools, be sure to pass all required parameters, at minimum."</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-83" class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>mk_mistralai_func(sums)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>{'type': 'function',
 'function': {'name': 'sums',
  'description': 'Adds a + b.\n\nReturns:\n- type: integer',
  'parameters': {'type': 'object',
   'properties': {'a': {'type': 'integer',
     'description': 'First thing to sum'},
    'b': {'type': 'integer', 'description': 'Second thing to sum'}},
   'required': ['a', 'b']}}}</code></pre>
</div>
</div>
<div id="cell-84" class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>[mk_mistralai_func(sums)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[{'type': 'function',
  'function': {'name': 'sums',
   'description': 'Adds a + b.\n\nReturns:\n- type: integer',
   'parameters': {'type': 'object',
    'properties': {'a': {'type': 'integer',
      'description': 'First thing to sum'},
     'b': {'type': 'integer', 'description': 'Second thing to sum'}},
    'required': ['a', 'b']}}}]</code></pre>
</div>
</div>
<div id="cell-85" class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>mk_tool_choice(<span class="st">"sums"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>{'type': 'function', 'function': {'name': 'sums'}}</code></pre>
</div>
</div>
<div id="cell-86" class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>a,b <span class="op">=</span> <span class="dv">604542</span>,<span class="dv">6458932</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>pr <span class="op">=</span> <span class="ss">f"What is </span><span class="sc">{</span>a<span class="sc">}</span><span class="ss">+</span><span class="sc">{</span>b<span class="sc">}</span><span class="ss">?"</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>tools <span class="op">=</span> [mk_mistralai_func(sums)]</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>tool_choice <span class="op">=</span> mk_tool_choice(<span class="st">"sums"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-87" class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>msgs <span class="op">=</span> [mk_msg(pr)]</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> c(msgs, sp<span class="op">=</span>sysp, tools<span class="op">=</span>tools)</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>r</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown">
<ul>
<li>id: 07d02cb9ef3844169736989a6f89f22f</li>
<li>object: chat.completion</li>
<li>model: mistral-large-2411</li>
<li>usage: prompt_tokens=144 completion_tokens=37 total_tokens=181</li>
<li>created: 1743585922</li>
<li>choices: [ChatCompletionChoice(index=0, message=AssistantMessage(content=’‘, tool_calls=[ToolCall(function=FunctionCall(name=’sums’, arguments=’{“a”: 604542, “b”: 6458932}’), id=’O3HmdZqak’, type=None, index=0)], prefix=False, role=’assistant’), finish_reason=‘tool_calls’)]</li>
</ul>
</div>
</div>
<div id="cell-88" class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>r.choices[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>ChatCompletionChoice(index=0, message=AssistantMessage(content='', tool_calls=[ToolCall(function=FunctionCall(name='sums', arguments='{"a": 604542, "b": 6458932}'), id='O3HmdZqak', type=None, index=0)], prefix=False, role='assistant'), finish_reason='tool_calls')</code></pre>
</div>
</div>
<div id="cell-89" class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> find_block(r)</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>m</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>AssistantMessage(content='', tool_calls=[ToolCall(function=FunctionCall(name='sums', arguments='{"a": 604542, "b": 6458932}'), id='O3HmdZqak', type=None, index=0)], prefix=False, role='assistant')</code></pre>
</div>
</div>
<div id="cell-90" class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the assistant message contains a tool_calls field witht the list of tool available/passed</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>tc <span class="op">=</span> m.tool_calls</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>tc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[ToolCall(function=FunctionCall(name='sums', arguments='{"a": 604542, "b": 6458932}'), id='O3HmdZqak', type=None, index=0)]</code></pre>
</div>
</div>
<div id="cell-91" class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>func <span class="op">=</span> tc[<span class="dv">0</span>].function</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>func</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>FunctionCall(name='sums', arguments='{"a": 604542, "b": 6458932}')</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/franckalbinet/mistinguette/blob/main/mistinguette/core.py#L197" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="call_func_mistralai" class="level3">
<h3 class="anchored" data-anchor-id="call_func_mistralai">call_func_mistralai</h3>
<blockquote class="blockquote">
<pre><code> call_func_mistralai (func:mistralai.models.functioncall.FunctionCall,
                      ns:Optional[collections.abc.Mapping]=None)</code></pre>
</blockquote>
<div id="cell-93" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> call_func_mistralai(func:FunctionCall, ns:Optional[abc.Mapping]<span class="op">=</span><span class="va">None</span>): </span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> call_func(func.name, ast.literal_eval(func.arguments), ns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-94" class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>mk_ns(sums)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>{'sums': &lt;function __main__.sums(a: int, b: int) -&gt; int&gt;}</code></pre>
</div>
</div>
<div id="cell-95" class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>ns <span class="op">=</span> mk_ns(sums)</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> call_func_mistralai(func, ns<span class="op">=</span>ns)</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Finding the sum of 604542 and 6458932</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>7063474</code></pre>
</div>
</div>
<p>Creating tool response messages with a structure compatible with OpenAI’s format:</p>
<hr>
<p><a href="https://github.com/franckalbinet/mistinguette/blob/main/mistinguette/core.py#L201" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="mk_toolres" class="level3">
<h3 class="anchored" data-anchor-id="mk_toolres">mk_toolres</h3>
<blockquote class="blockquote">
<pre><code> mk_toolres (r:collections.abc.Mapping,
             ns:Optional[collections.abc.Mapping]=None, obj:Optional=None)</code></pre>
</blockquote>
<p><em>Create a <code>tool_result</code> message from response <code>r</code>.</em></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>r</td>
<td>Mapping</td>
<td></td>
<td>Tool use request response</td>
</tr>
<tr class="even">
<td>ns</td>
<td>Optional</td>
<td>None</td>
<td>Namespace to search for tools</td>
</tr>
<tr class="odd">
<td>obj</td>
<td>Optional</td>
<td>None</td>
<td>Class to search for tools</td>
</tr>
</tbody>
</table>
<div id="cell-98" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mk_toolres(</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>    r:abc.Mapping, <span class="co"># Tool use request response</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>    ns:Optional[abc.Mapping]<span class="op">=</span><span class="va">None</span>, <span class="co"># Namespace to search for tools</span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>    obj:Optional<span class="op">=</span><span class="va">None</span> <span class="co"># Class to search for tools</span></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>    ):</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Create a `tool_result` message from response `r`."</span></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> mk_msg(r)</span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>    tcs <span class="op">=</span> <span class="bu">getattr</span>(r, <span class="st">'tool_calls'</span>, [])</span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> [r]</span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ns <span class="kw">is</span> <span class="va">None</span>: ns <span class="op">=</span> <span class="bu">globals</span>()</span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> obj <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>: ns <span class="op">=</span> mk_ns(obj)</span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> tc <span class="kw">in</span> (tcs <span class="kw">or</span> []):</span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a>        func <span class="op">=</span> tc.function</span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a>        cts <span class="op">=</span> <span class="bu">str</span>(call_func_mistralai(func, ns<span class="op">=</span>ns))</span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a>        res.append(mk_msg(<span class="bu">str</span>(cts), <span class="st">'tool'</span>, tool_call_id<span class="op">=</span>tc.<span class="bu">id</span>, name<span class="op">=</span>func.name))</span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-99" class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>tr <span class="op">=</span> mk_toolres(r, ns<span class="op">=</span>ns)</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>tr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Finding the sum of 604542 and 6458932</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>[AssistantMessage(content='', tool_calls=[ToolCall(function=FunctionCall(name='sums', arguments='{"a": 604542, "b": 6458932}'), id='O3HmdZqak', type=None, index=0)], prefix=False, role='assistant'),
 {'role': 'tool',
  'content': '7063474',
  'tool_call_id': 'O3HmdZqak',
  'name': 'sums'}]</code></pre>
</div>
</div>
<div id="cell-100" class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>tr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[AssistantMessage(content='', tool_calls=[ToolCall(function=FunctionCall(name='sums', arguments='{"a": 604542, "b": 6458932}'), id='O3HmdZqak', type=None, index=0)], prefix=False, role='assistant'),
 {'role': 'tool',
  'content': '7063474',
  'tool_call_id': 'O3HmdZqak',
  'name': 'sums'}]</code></pre>
</div>
</div>
<div id="cell-101" class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>msgs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[{'role': 'user', 'content': 'What is 604542+6458932?'}]</code></pre>
</div>
</div>
<div id="cell-102" class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>msgs <span class="op">+=</span> tr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-103" class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>msgs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[{'role': 'user', 'content': 'What is 604542+6458932?'},
 AssistantMessage(content='', tool_calls=[ToolCall(function=FunctionCall(name='sums', arguments='{"a": 604542, "b": 6458932}'), id='O3HmdZqak', type=None, index=0)], prefix=False, role='assistant'),
 {'role': 'tool',
  'content': '7063474',
  'tool_call_id': 'O3HmdZqak',
  'name': 'sums'}]</code></pre>
</div>
</div>
<div id="cell-104" class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>msgs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[{'role': 'user', 'content': 'What is 604542+6458932?'},
 AssistantMessage(content='', tool_calls=[ToolCall(function=FunctionCall(name='sums', arguments='{"a": 604542, "b": 6458932}'), id='O3HmdZqak', type=None, index=0)], prefix=False, role='assistant'),
 {'role': 'tool',
  'content': '7063474',
  'tool_call_id': 'O3HmdZqak',
  'name': 'sums'}]</code></pre>
</div>
</div>
<div id="cell-105" class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> c(msgs, sp<span class="op">=</span>sysp, tools<span class="op">=</span>tools)</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown">
<p>604542+6458932=7063474</p>
<details>
<ul>
<li>id: 2190853f05504ec9bfa4e670a9112efa</li>
<li>object: chat.completion</li>
<li>model: mistral-large-2411</li>
<li>usage: prompt_tokens=211 completion_tokens=24 total_tokens=235</li>
<li>created: 1743585932</li>
<li>choices: [ChatCompletionChoice(index=0, message=AssistantMessage(content=‘604542+6458932=7063474’, tool_calls=None, prefix=False, role=‘assistant’), finish_reason=‘stop’)]</li>
</ul>
</details>
</div>
</div>
<div id="cell-106" class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Dummy:</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> sums(</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>,</span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>        a:<span class="bu">int</span>,  <span class="co"># First thing to sum</span></span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>        b:<span class="bu">int</span><span class="op">=</span><span class="dv">1</span> <span class="co"># Second thing to sum</span></span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">-&gt;</span> <span class="bu">int</span>: <span class="co"># The sum of the inputs</span></span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">"Adds a + b."</span></span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Finding the sum of </span><span class="sc">{</span>a<span class="sc">}</span><span class="ss"> and </span><span class="sc">{</span>b<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> a <span class="op">+</span> b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-107" class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>tools <span class="op">=</span> [mk_mistralai_func(Dummy.sums)]<span class="op">;</span> tools</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[{'type': 'function',
  'function': {'name': 'sums',
   'description': 'Adds a + b.\n\nReturns:\n- type: integer',
   'parameters': {'type': 'object',
    'properties': {'a': {'type': 'integer',
      'description': 'First thing to sum'},
     'b': {'type': 'integer',
      'description': 'Second thing to sum',
      'default': 1}},
    'required': ['a']}}}]</code></pre>
</div>
</div>
<div id="cell-108" class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>tools <span class="op">=</span> [mk_mistralai_func(Dummy.sums)]</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>o <span class="op">=</span> Dummy()</span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>msgs <span class="op">=</span> mk_toolres(pr)</span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> c(msgs, sp<span class="op">=</span>sysp, tools<span class="op">=</span>tools)</span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a>msgs <span class="op">+=</span> mk_toolres(r, obj<span class="op">=</span>o)</span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> c(msgs, sp<span class="op">=</span>sysp, tools<span class="op">=</span>tools)</span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a>res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Finding the sum of 604542 and 6458932</code></pre>
</div>
<div class="cell-output cell-output-display cell-output-markdown">
<p>604542 + 6458932 = 7063474</p>
<details>
<ul>
<li>id: babf6b7c41b347e9bcbc6fd0606a0756</li>
<li>object: chat.completion</li>
<li>model: mistral-large-2411</li>
<li>usage: prompt_tokens=213 completion_tokens=26 total_tokens=239</li>
<li>created: 1743585936</li>
<li>choices: [ChatCompletionChoice(index=0, message=AssistantMessage(content=‘604542 + 6458932 = 7063474’, tool_calls=None, prefix=False, role=‘assistant’), finish_reason=‘stop’)]</li>
</ul>
</details>
</div>
</div>
<hr>
<p><a href="https://github.com/franckalbinet/mistinguette/blob/main/mistinguette/core.py#L221" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="mock_tooluse" class="level3">
<h3 class="anchored" data-anchor-id="mock_tooluse">mock_tooluse</h3>
<blockquote class="blockquote">
<pre><code> mock_tooluse (name:str, res, **kwargs)</code></pre>
</blockquote>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>name</td>
<td>str</td>
<td>The name of the called function</td>
</tr>
<tr class="even">
<td>res</td>
<td></td>
<td>The result of calling the function</td>
</tr>
<tr class="odd">
<td>kwargs</td>
<td>VAR_KEYWORD</td>
<td></td>
</tr>
</tbody>
</table>
<div id="cell-110" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _mock_id(): <span class="cf">return</span> <span class="st">''</span>.join(choices(ascii_letters<span class="op">+</span>digits, k<span class="op">=</span><span class="dv">9</span>))</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mock_tooluse(name:<span class="bu">str</span>, <span class="co"># The name of the called function</span></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>                 res,  <span class="co"># The result of calling the function</span></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>                 <span class="op">**</span>kwargs): <span class="co"># The arguments to the function</span></span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">""</span></span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">id</span> <span class="op">=</span> _mock_id()</span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a>    func <span class="op">=</span> <span class="bu">dict</span>(arguments<span class="op">=</span>json.dumps(kwargs), name<span class="op">=</span>name)</span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a>    tc <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">id</span><span class="op">=</span><span class="bu">id</span>, function<span class="op">=</span>func, <span class="bu">type</span><span class="op">=</span><span class="st">'function'</span>)</span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a>    req <span class="op">=</span> <span class="bu">dict</span>(content<span class="op">=</span><span class="va">None</span>, role<span class="op">=</span><span class="st">'assistant'</span>, tool_calls<span class="op">=</span>[tc])</span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a>    resp <span class="op">=</span> mk_msg(<span class="st">''</span> <span class="cf">if</span> res <span class="kw">is</span> <span class="va">None</span> <span class="cf">else</span> <span class="bu">str</span>(res), <span class="st">'tool'</span>, tool_call_id<span class="op">=</span><span class="bu">id</span>, name<span class="op">=</span>name)</span>
<span id="cb133-12"><a href="#cb133-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [req,resp]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>This function mocks the messages needed to implement tool use, for situations where you want to insert tool use messages into a dialog without actually calling into the model.</p>
<div id="cell-112" class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>tu <span class="op">=</span> mock_tooluse(name<span class="op">=</span><span class="st">'sums'</span>, res<span class="op">=</span><span class="dv">7063474</span>, a<span class="op">=</span><span class="dv">604542</span>, b<span class="op">=</span><span class="dv">6458932</span>)</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> c([mk_msg(pr)]<span class="op">+</span>tu, tools<span class="op">=</span>tools)</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>r</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown">
<p>604542 + 6458932 = 7063474</p>
<details>
<ul>
<li>id: 19a68c8418e54030bb38be69d4e52a45</li>
<li>object: chat.completion</li>
<li>model: mistral-large-2411</li>
<li>usage: prompt_tokens=193 completion_tokens=26 total_tokens=219</li>
<li>created: 1743585938</li>
<li>choices: [ChatCompletionChoice(index=0, message=AssistantMessage(content=‘604542 + 6458932 = 7063474’, tool_calls=None, prefix=False, role=‘assistant’), finish_reason=‘stop’)]</li>
</ul>
</details>
</div>
</div>
<p>Structured outputs</p>
<hr>
<p><a href="https://github.com/franckalbinet/mistinguette/blob/main/mistinguette/core.py#L235" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="client.structured" class="level3">
<h3 class="anchored" data-anchor-id="client.structured">Client.structured</h3>
<blockquote class="blockquote">
<pre><code> Client.structured (msgs:list, tools:Optional[list]=None,
                    obj:Optional=None,
                    ns:Optional[collections.abc.Mapping]=None, sp:str='',
                    maxtok=4096, stream:bool=False,
                    temperature:OptionalNullable[float]=Unset(),
                    top_p:Optional[float]=None,
                    max_tokens:OptionalNullable[int]=Unset(),
                    stop:Union[Stop,StopTypedDict,NoneType]=None,
                    random_seed:OptionalNullable[int]=Unset(), response_fo
                    rmat:Union[mistralai.models.responseformat.ResponseFor
                    mat,mistralai.models.responseformat.ResponseFormatType
                    dDict,NoneType]=None, tool_choice:Union[ChatCompletion
                    RequestToolChoice,ChatCompletionRequestToolChoiceTyped
                    Dict,NoneType]=None,
                    presence_penalty:Optional[float]=None,
                    frequency_penalty:Optional[float]=None,
                    n:OptionalNullable[int]=Unset(), prediction:Union[mist
                    ralai.models.prediction.Prediction,mistralai.models.pr
                    ediction.PredictionTypedDict,NoneType]=None,
                    parallel_tool_calls:Optional[bool]=None,
                    safe_prompt:Optional[bool]=None, retries:OptionalNulla
                    ble[mistralai.utils.retries.RetryConfig]=Unset(),
                    server_url:Optional[str]=None,
                    timeout_ms:Optional[int]=None,
                    http_headers:Optional[Mapping[str,str]]=None)</code></pre>
</blockquote>
<p><em>Return the value of all tool calls (generally used for structured outputs)</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>msgs</td>
<td>list</td>
<td></td>
<td>Prompt</td>
</tr>
<tr class="even">
<td>tools</td>
<td>Optional</td>
<td>None</td>
<td>List of tools to make available to OpenAI model</td>
</tr>
<tr class="odd">
<td>obj</td>
<td>Optional</td>
<td>None</td>
<td>Class to search for tools</td>
</tr>
<tr class="even">
<td>ns</td>
<td>Optional</td>
<td>None</td>
<td>Namespace to search for tools</td>
</tr>
<tr class="odd">
<td>sp</td>
<td>str</td>
<td></td>
<td>System prompt</td>
</tr>
<tr class="even">
<td>maxtok</td>
<td>int</td>
<td>4096</td>
<td>Maximum tokens</td>
</tr>
<tr class="odd">
<td>stream</td>
<td>bool</td>
<td>False</td>
<td>Stream response?</td>
</tr>
<tr class="even">
<td>temperature</td>
<td>OptionalNullable</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>top_p</td>
<td>Optional</td>
<td>None</td>
<td></td>
</tr>
<tr class="even">
<td>max_tokens</td>
<td>OptionalNullable</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>stop</td>
<td>Union</td>
<td>None</td>
<td></td>
</tr>
<tr class="even">
<td>random_seed</td>
<td>OptionalNullable</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>response_format</td>
<td>Union</td>
<td>None</td>
<td></td>
</tr>
<tr class="even">
<td>tool_choice</td>
<td>Union</td>
<td>None</td>
<td></td>
</tr>
<tr class="odd">
<td>presence_penalty</td>
<td>Optional</td>
<td>None</td>
<td></td>
</tr>
<tr class="even">
<td>frequency_penalty</td>
<td>Optional</td>
<td>None</td>
<td></td>
</tr>
<tr class="odd">
<td>n</td>
<td>OptionalNullable</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>prediction</td>
<td>Union</td>
<td>None</td>
<td></td>
</tr>
<tr class="odd">
<td>parallel_tool_calls</td>
<td>Optional</td>
<td>None</td>
<td></td>
</tr>
<tr class="even">
<td>safe_prompt</td>
<td>Optional</td>
<td>None</td>
<td></td>
</tr>
<tr class="odd">
<td>retries</td>
<td>OptionalNullable</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>server_url</td>
<td>Optional</td>
<td>None</td>
<td></td>
</tr>
<tr class="odd">
<td>timeout_ms</td>
<td>Optional</td>
<td>None</td>
<td></td>
</tr>
<tr class="even">
<td>http_headers</td>
<td>Optional</td>
<td>None</td>
<td></td>
</tr>
</tbody>
</table>
<div id="cell-115" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="at">@patch</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="at">@delegates</span>(Client.<span class="fu">__call__</span>)</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> structured(<span class="va">self</span>:Client,</span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>               msgs: <span class="bu">list</span>, <span class="co"># Prompt</span></span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>               tools:Optional[<span class="bu">list</span>]<span class="op">=</span><span class="va">None</span>, <span class="co"># List of tools to make available to OpenAI model</span></span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>               obj:Optional<span class="op">=</span><span class="va">None</span>, <span class="co"># Class to search for tools</span></span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a>               ns:Optional[abc.Mapping]<span class="op">=</span><span class="va">None</span>, <span class="co"># Namespace to search for tools</span></span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a>               <span class="op">**</span>kwargs):</span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Return the value of all tool calls (generally used for structured outputs)"</span></span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a>    tools <span class="op">=</span> listify(tools)</span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ns <span class="kw">is</span> <span class="va">None</span>: ns<span class="op">=</span>mk_ns(<span class="op">*</span>tools)</span>
<span id="cb136-12"><a href="#cb136-12" aria-hidden="true" tabindex="-1"></a>    tools <span class="op">=</span> [mk_mistralai_func(o) <span class="cf">for</span> o <span class="kw">in</span> tools]</span>
<span id="cb136-13"><a href="#cb136-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> obj <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>: ns <span class="op">=</span> mk_ns(obj)</span>
<span id="cb136-14"><a href="#cb136-14" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> <span class="va">self</span>(msgs, tools<span class="op">=</span>tools, tool_choice<span class="op">=</span><span class="st">'required'</span>, <span class="op">**</span>kwargs)</span>
<span id="cb136-15"><a href="#cb136-15" aria-hidden="true" tabindex="-1"></a>    cts <span class="op">=</span> <span class="bu">getattr</span>(res, <span class="st">'choices'</span>, [])</span>
<span id="cb136-16"><a href="#cb136-16" aria-hidden="true" tabindex="-1"></a>    tcs <span class="op">=</span> [call_func_mistralai(t.function, ns<span class="op">=</span>ns) <span class="cf">for</span> o <span class="kw">in</span> cts <span class="cf">for</span> t <span class="kw">in</span> (o.message.tool_calls <span class="kw">or</span> [])]</span>
<span id="cb136-17"><a href="#cb136-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tcs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Mistral’s API doesn’t natively support response formats <strong>[TO BE CONFIRMED]</strong>, so we introduce a <code>structured</code> method to handle tool calling for this purpose. In this setup, the tool’s result is sent directly to the user without being passed back to the model.</p>
<div id="cell-117" class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>c.structured(mk_msgs(pr), tools<span class="op">=</span>[sums])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Finding the sum of 604542 and 6458932</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>[7063474]</code></pre>
</div>
</div>
</section>
</section>
<section id="chat" class="level2">
<h2 class="anchored" data-anchor-id="chat">Chat</h2>
<hr>
<p><a href="https://github.com/franckalbinet/mistinguette/blob/main/mistinguette/core.py#L252" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="chat-1" class="level3">
<h3 class="anchored" data-anchor-id="chat-1">Chat</h3>
<blockquote class="blockquote">
<pre><code> Chat (model:Optional[str]=None, cli:Optional[__main__.Client]=None,
       sp='', tools:Optional[list]=None, tool_choice:Optional[str]=None)</code></pre>
</blockquote>
<p><em>OpenAI chat client.</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>model</td>
<td>Optional</td>
<td>None</td>
<td>Model to use (leave empty if passing <code>cli</code>)</td>
</tr>
<tr class="even">
<td>cli</td>
<td>Optional</td>
<td>None</td>
<td>Client to use (leave empty if passing <code>model</code>)</td>
</tr>
<tr class="odd">
<td>sp</td>
<td>str</td>
<td></td>
<td>Optional system prompt</td>
</tr>
<tr class="even">
<td>tools</td>
<td>Optional</td>
<td>None</td>
<td>List of tools to make available</td>
</tr>
<tr class="odd">
<td>tool_choice</td>
<td>Optional</td>
<td>None</td>
<td>Forced tool choice</td>
</tr>
</tbody>
</table>
<div id="cell-120" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Chat:</span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>,</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>                 model:Optional[<span class="bu">str</span>]<span class="op">=</span><span class="va">None</span>, <span class="co"># Model to use (leave empty if passing `cli`)</span></span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>                 cli:Optional[Client]<span class="op">=</span><span class="va">None</span>, <span class="co"># Client to use (leave empty if passing `model`)</span></span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>                 sp<span class="op">=</span><span class="st">''</span>, <span class="co"># Optional system prompt</span></span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>                 tools:Optional[<span class="bu">list</span>]<span class="op">=</span><span class="va">None</span>,  <span class="co"># List of tools to make available</span></span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a>                 tool_choice:Optional[<span class="bu">str</span>]<span class="op">=</span><span class="va">None</span>): <span class="co"># Forced tool choice</span></span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">"OpenAI chat client."</span></span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> model <span class="kw">or</span> cli</span>
<span id="cb141-10"><a href="#cb141-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.c <span class="op">=</span> (cli <span class="kw">or</span> Client(model))</span>
<span id="cb141-11"><a href="#cb141-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.h,<span class="va">self</span>.sp,<span class="va">self</span>.tools,<span class="va">self</span>.tool_choice <span class="op">=</span> [],sp,tools,tool_choice</span>
<span id="cb141-12"><a href="#cb141-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb141-13"><a href="#cb141-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb141-14"><a href="#cb141-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> use(<span class="va">self</span>): <span class="cf">return</span> <span class="va">self</span>.c.use</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-121" class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>sp <span class="op">=</span> <span class="st">"Never mention what tools you use."</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>chat <span class="op">=</span> Chat(model, sp<span class="op">=</span>sp)</span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>chat.c.use, chat.h</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(In: 0; Out: 0; Total: 0, [])</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/franckalbinet/mistinguette/blob/main/mistinguette/core.py#L270" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="chat.__call__" class="level3">
<h3 class="anchored" data-anchor-id="chat.__call__">Chat.__call__</h3>
<blockquote class="blockquote">
<pre><code> Chat.__call__ (pr=None, stream:bool=False,
                temperature:OptionalNullable[float]=Unset(),
                top_p:Optional[float]=None,
                max_tokens:OptionalNullable[int]=Unset(),
                stop:Union[Stop,StopTypedDict,NoneType]=None,
                random_seed:OptionalNullable[int]=Unset(), response_format
                :Union[mistralai.models.responseformat.ResponseFormat,mist
                ralai.models.responseformat.ResponseFormatTypedDict,NoneTy
                pe]=None, tools:OptionalNullable[typing.Union[typing.List[
                mistralai.models.tool.Tool],typing.List[mistralai.models.t
                ool.ToolTypedDict]]]=Unset(), tool_choice:Union[ChatComple
                tionRequestToolChoice,ChatCompletionRequestToolChoiceTyped
                Dict,NoneType]=None,
                presence_penalty:Optional[float]=None,
                frequency_penalty:Optional[float]=None,
                n:OptionalNullable[int]=Unset(), prediction:Union[mistrala
                i.models.prediction.Prediction,mistralai.models.prediction
                .PredictionTypedDict,NoneType]=None,
                parallel_tool_calls:Optional[bool]=None,
                safe_prompt:Optional[bool]=None, retries:OptionalNullable[
                mistralai.utils.retries.RetryConfig]=Unset(),
                server_url:Optional[str]=None,
                timeout_ms:Optional[int]=None,
                http_headers:Optional[Mapping[str,str]]=None)</code></pre>
</blockquote>
<p><em>Add prompt <code>pr</code> to dialog and get a response</em></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>pr</td>
<td>NoneType</td>
<td>None</td>
<td>Prompt / message</td>
</tr>
<tr class="even">
<td>stream</td>
<td>bool</td>
<td>False</td>
<td>Stream response?</td>
</tr>
<tr class="odd">
<td>temperature</td>
<td>OptionalNullable</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>top_p</td>
<td>Optional</td>
<td>None</td>
<td></td>
</tr>
<tr class="odd">
<td>max_tokens</td>
<td>OptionalNullable</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>stop</td>
<td>Union</td>
<td>None</td>
<td></td>
</tr>
<tr class="odd">
<td>random_seed</td>
<td>OptionalNullable</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>response_format</td>
<td>Union</td>
<td>None</td>
<td></td>
</tr>
<tr class="odd">
<td>tools</td>
<td>OptionalNullable</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>tool_choice</td>
<td>Union</td>
<td>None</td>
<td></td>
</tr>
<tr class="odd">
<td>presence_penalty</td>
<td>Optional</td>
<td>None</td>
<td></td>
</tr>
<tr class="even">
<td>frequency_penalty</td>
<td>Optional</td>
<td>None</td>
<td></td>
</tr>
<tr class="odd">
<td>n</td>
<td>OptionalNullable</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>prediction</td>
<td>Union</td>
<td>None</td>
<td></td>
</tr>
<tr class="odd">
<td>parallel_tool_calls</td>
<td>Optional</td>
<td>None</td>
<td></td>
</tr>
<tr class="even">
<td>safe_prompt</td>
<td>Optional</td>
<td>None</td>
<td></td>
</tr>
<tr class="odd">
<td>retries</td>
<td>OptionalNullable</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>server_url</td>
<td>Optional</td>
<td>None</td>
<td></td>
</tr>
<tr class="odd">
<td>timeout_ms</td>
<td>Optional</td>
<td>None</td>
<td></td>
</tr>
<tr class="even">
<td>http_headers</td>
<td>Optional</td>
<td>None</td>
<td></td>
</tr>
</tbody>
</table>
<div id="cell-123" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="at">@patch</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a><span class="at">@delegates</span>(mistralai.Chat.complete)</span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="fu">__call__</span>(<span class="va">self</span>:Chat,</span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>             pr<span class="op">=</span><span class="va">None</span>,  <span class="co"># Prompt / message</span></span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a>             stream:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span>, <span class="co"># Stream response?</span></span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a>             <span class="op">**</span>kwargs):</span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Add prompt `pr` to dialog and get a response"</span></span>
<span id="cb145-8"><a href="#cb145-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(pr,<span class="bu">str</span>): pr <span class="op">=</span> pr.strip()</span>
<span id="cb145-9"><a href="#cb145-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> pr: <span class="va">self</span>.h.append(mk_msg(pr))</span>
<span id="cb145-10"><a href="#cb145-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="va">self</span>.tools: kwargs[<span class="st">'tools'</span>] <span class="op">=</span> [mk_mistralai_func(o) <span class="cf">for</span> o <span class="kw">in</span> <span class="va">self</span>.tools]</span>
<span id="cb145-11"><a href="#cb145-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="va">self</span>.tool_choice: kwargs[<span class="st">'tool_choice'</span>] <span class="op">=</span> mk_tool_choice(<span class="va">self</span>.tool_choice)</span>
<span id="cb145-12"><a href="#cb145-12" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> <span class="va">self</span>.c(<span class="va">self</span>.h, sp<span class="op">=</span><span class="va">self</span>.sp, stream<span class="op">=</span>stream, <span class="op">**</span>kwargs)</span>
<span id="cb145-13"><a href="#cb145-13" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.h <span class="op">+=</span> mk_toolres(res, ns<span class="op">=</span><span class="va">self</span>.tools)</span>
<span id="cb145-14"><a href="#cb145-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-124" class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>chat(<span class="st">"I'm Jeremy"</span>)</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>chat(<span class="st">"What's my name?"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown">
<p>You mentioned that your name is Jeremy! How can I assist you today, Jeremy?</p>
<details>
<ul>
<li>id: 8ffe24005682455eb3a88b18eeedc8cd</li>
<li>object: chat.completion</li>
<li>model: mistral-large-2411</li>
<li>usage: prompt_tokens=38 completion_tokens=18 total_tokens=56</li>
<li>created: 1743585946</li>
<li>choices: [ChatCompletionChoice(index=0, message=AssistantMessage(content=‘You mentioned that your name is Jeremy! How can I assist you today, Jeremy?’, tool_calls=None, prefix=False, role=‘assistant’), finish_reason=‘stop’)]</li>
</ul>
</details>
</div>
</div>
<div id="cell-125" class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>chat.h</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[{'role': 'user', 'content': "I'm Jeremy"},
 AssistantMessage(content='Hello Jeremy! Nice to meet you. How are you today?', tool_calls=None, prefix=False, role='assistant'),
 {'role': 'user', 'content': "What's my name?"},
 AssistantMessage(content='You mentioned that your name is Jeremy! How can I assist you today, Jeremy?', tool_calls=None, prefix=False, role='assistant')]</code></pre>
</div>
</div>
<div id="cell-126" class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>chat <span class="op">=</span> Chat(model, sp<span class="op">=</span>sp)</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> o <span class="kw">in</span> chat(<span class="st">"I'm Jeremy"</span>, stream<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>    o <span class="op">=</span> contents(o)</span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> o <span class="kw">and</span> <span class="bu">isinstance</span>(o, <span class="bu">str</span>): <span class="bu">print</span>(o, end<span class="op">=</span><span class="st">''</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Hello Jeremy! Nice to meet you. How are you today?</code></pre>
</div>
</div>
<div id="cell-127" class="cell">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>chat <span class="op">=</span> Chat(model, sp<span class="op">=</span>sp)</span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>problem <span class="op">=</span> <span class="st">"1233 * 4297"</span></span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Correct Answer: </span><span class="sc">{</span>problem<span class="sc">}</span><span class="ss"> = </span><span class="sc">{</span><span class="bu">eval</span>(problem)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> chat(<span class="ss">f"what is </span><span class="sc">{</span>problem<span class="sc">}</span><span class="ss">?"</span>)</span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Model answer: </span><span class="sc">{</span>contents(r)<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Correct Answer: 1233 * 4297 = 5298201
Model answer: The product of 1233 and 4297 is 5,297,901.</code></pre>
</div>
</div>
</section>
<section id="chat-tool-use" class="level3">
<h3 class="anchored" data-anchor-id="chat-tool-use">Chat tool use</h3>
<div id="cell-129" class="cell">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>pr <span class="op">=</span> <span class="ss">f"What is </span><span class="sc">{</span>a<span class="sc">}</span><span class="ss">+</span><span class="sc">{</span>b<span class="sc">}</span><span class="ss">?"</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>pr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>'What is 604542+6458932?'</code></pre>
</div>
</div>
<div id="cell-130" class="cell">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>'mistral-large-2411'</code></pre>
</div>
</div>
<div id="cell-131" class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Debug</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-132" class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>sp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>'Never mention what tools you use.'</code></pre>
</div>
</div>
<div id="cell-133" class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>a,b <span class="op">=</span> <span class="dv">604542</span>,<span class="dv">6458932</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>pr <span class="op">=</span> <span class="ss">f"What is </span><span class="sc">{</span>a<span class="sc">}</span><span class="ss">+</span><span class="sc">{</span>b<span class="sc">}</span><span class="ss">?"</span></span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>pr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>'What is 604542+6458932?'</code></pre>
</div>
</div>
<div id="cell-134" class="cell">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>chat <span class="op">=</span> Chat(model, sp<span class="op">=</span>sp, tools<span class="op">=</span>[sums])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-135" class="cell">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> chat(pr)</span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>r</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Finding the sum of 604542 and 6458932</code></pre>
</div>
<div class="cell-output cell-output-display cell-output-markdown">
<ul>
<li>id: 9d017b8f4278452787f840108651a697</li>
<li>object: chat.completion</li>
<li>model: mistral-large-2411</li>
<li>usage: prompt_tokens=130 completion_tokens=37 total_tokens=167</li>
<li>created: 1743589168</li>
<li>choices: [ChatCompletionChoice(index=0, message=AssistantMessage(content=’‘, tool_calls=[ToolCall(function=FunctionCall(name=’sums’, arguments=’{“a”: 604542, “b”: 6458932}’), id=’qCyqNX6qy’, type=None, index=0)], prefix=False, role=’assistant’), finish_reason=‘tool_calls’)]</li>
</ul>
</div>
</div>
<div id="cell-136" class="cell">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>chat()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown">
<p>What is 604542+6458932?</p>
<p>604542+6458932=7063474</p>
<details>
<ul>
<li>id: 6fc66b906dab4fbd91e81bf08f47f375</li>
<li>object: chat.completion</li>
<li>model: mistral-large-2411</li>
<li>usage: prompt_tokens=201 completion_tokens=43 total_tokens=244</li>
<li>created: 1743589186</li>
<li>choices: [ChatCompletionChoice(index=0, message=AssistantMessage(content=‘What is 604542+6458932?+6458932=7063474’, tool_calls=None, prefix=False, role=‘assistant’), finish_reason=‘stop’)]</li>
</ul>
</details>
</div>
</div>
<div id="cell-137" class="cell">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Debug</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-138" class="cell">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>chat <span class="op">=</span> Chat(model, sp<span class="op">=</span>sp, tools<span class="op">=</span>[sums])</span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> chat(pr)</span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>r</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Finding the sum of 604542 and 6458932</code></pre>
</div>
<div class="cell-output cell-output-display cell-output-markdown">
<ul>
<li>id: c97386aa2f884c04ab53f17aa074a7c3</li>
<li>object: chat.completion</li>
<li>model: mistral-large-2411</li>
<li>usage: prompt_tokens=130 completion_tokens=37 total_tokens=167</li>
<li>created: 1743589105</li>
<li>choices: [ChatCompletionChoice(index=0, message=AssistantMessage(content=’‘, tool_calls=[ToolCall(function=FunctionCall(name=’sums’, arguments=’{“a”: 604542, “b”: 6458932}’), id=’hvktCFryO’, type=None, index=0)], prefix=False, role=’assistant’), finish_reason=‘tool_calls’)]</li>
</ul>
</div>
</div>
<div id="cell-139" class="cell">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>chat()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown">
<p>604542 + 6458932 equals 7063474. Is there anything else I can help you with?</p>
<details>
<ul>
<li>id: 65451e31882846b8b42fd87de56702f1</li>
<li>object: chat.completion</li>
<li>model: mistral-large-2411</li>
<li>usage: prompt_tokens=195 completion_tokens=37 total_tokens=232</li>
<li>created: 1743589109</li>
<li>choices: [ChatCompletionChoice(index=0, message=AssistantMessage(content=‘604542 + 6458932 equals 7063474. Is there anything else I can help you with?’, tool_calls=None, prefix=False, role=‘assistant’), finish_reason=‘stop’)]</li>
</ul>
</details>
</div>
</div>
</section>
</section>
<section id="images" class="level2">
<h2 class="anchored" data-anchor-id="images">Images</h2>
<p>As everyone knows, when testing image APIs you have to use a cute puppy.</p>
<div id="cell-142" class="cell">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Image is Cute_dog.jpg from Wikimedia</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>fn <span class="op">=</span> Path(<span class="st">'samples/puppy.jpg'</span>)</span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>display.Image(filename<span class="op">=</span>fn, width<span class="op">=</span><span class="dv">200</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="00_core_files/figure-html/cell-122-output-1.jpeg" class="img-fluid figure-img" width="200"></p>
</figure>
</div>
</div>
</div>
<div id="cell-143" class="cell">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> fn.read_bytes()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Mistral AI expects an image message to have the following structure</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"type"</span><span class="op">:</span> <span class="st">"image_url"</span><span class="op">,</span></span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"image_url"</span><span class="op">:</span> {</span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"url"</span><span class="op">:</span> f<span class="st">"data:{MEDIA_TYPE};base64,{IMG}"</span></span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>msglm</code> automatically detects if a message is an image, encodes it, and generates the data structure above. All we need to do is a create a list containing our image and a query and then pass it to <code>mk_msg</code>.</p>
<p>Let’s try it out…</p>
<div id="cell-145" class="cell">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>q <span class="op">=</span> <span class="st">"In brief, what color flowers are in this image?"</span></span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>msg <span class="op">=</span> [mk_msg(img), mk_msg(q)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-146" class="cell">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>vision_models</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>['pixtral-large-2411', 'mistral-small-2503', 'mistral-ocr-2503']</code></pre>
</div>
</div>
<div id="cell-147" class="cell">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> Chat(vision_models[<span class="dv">0</span>])</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>c([img, q])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown">
<p>The flowers in the image are purple with yellow centers.</p>
<details>
<ul>
<li>id: 7419ce04d287433991f72ed2b079b1bc</li>
<li>object: chat.completion</li>
<li>model: pixtral-large-2411</li>
<li>usage: prompt_tokens=274 completion_tokens=11 total_tokens=285</li>
<li>created: 1743582905</li>
<li>choices: [ChatCompletionChoice(index=0, message=AssistantMessage(content=‘The flowers in the image are purple with yellow centers.’, tool_calls=None, prefix=False, role=‘assistant’), finish_reason=‘stop’)]</li>
</ul>
</details>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/franckalbinet\.github\.io\/mistinguette");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/franckalbinet/mistinguette/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>